# Solution architect

- :label: #solutionArch

## Почему микросервисы могут разорить, а монолит выручить | Владимир Иванов | #32, 2025

- https://vkvideo.ru/video-224967259_456239090

Владимир Иванов, Senior Engineering Manager в Bolt (аренда самокатов)

Многоэтапные интервью входят в моду, отдельные секции системного дизайна.

Nowadays every company is an IT company, вроде сказал кто-то в Google. Иначе бизнес будет неоптимальным.

ВУЗ даёт базу (Матстатистика, теория надёжности, безопасность, сети, операционные системы) . Из ВУЗа не выходят с пониманием, как делать систему.

Некоторые советуют изучить архитектуру Netflix и Spotify.

Мокевнин: а с точки зрения бизнеса, например, разбиение на микросервисы надо было? Может, был более лёгкий путь реализовать то же самое.

При смене требований меняется архитектура решения. Стриминг видео и стриминг музыки - совершенно разные решения.

Мокевнин: а программировании не бывает достаточной системы, она всегда развивается.

Закон Конвея - архитектура системы повторяет организационную структуру.

17:50 общая логика микросервисов - пришлось синхронизировать (создание инвойсов, управление контрагентов). Некоторые микросервисы исчезли, появились новые, изменился dataflow. Бизнес-требования диктуют организационную структуру сервисов.

19:50 Не бывает плохих архитектур, бывают дорогие. Нужно думать, что будет нести максимальную эффективность с точки зрения вложения средств. Time-to-market важен практически всегда. Максимум через полгода нужно иметь готовое решение: конкуренты, ситуация на рынке, законы.

22:00 Solution architect roadmap. Доступность, поддерживаемость, производительность, масштабируемость. RDS (Relational Database Server) для PostgreSQL / DynamoDB. Знать сети для базовой безопасности. Observability.

24:40 Soft-скиллы. Техписатели, QA, Стейкхолдеры. Убеждение, коммуникации, persuading. Конфликт-менеджмент, бизнес-коммуникация. Найм правильных людей. Самому всё делать не получится.

27:00 сейчас платформы предлагают много готовых решений, best practices, туториалы

29:20 Запустили подпроект в TimeWeb, раз в 6 дешевле Яндекса. Владимир: облака могут быть дешевле на начальных этапах ненагруженых проектов

32:50 решать задачу, которая может не возникнуть даже через год это неоптимально. Высокая посещаемость скорее всего означает, что появился бюджет всё оптимизировать/переписать.

33:30 бывает, микросервисы строятся по одному dataflow а потом оказывается, что нужно давать какую-нибудь скидку на основании отчёта и каждый микросервис может начать ходить в каждый.

35:18 на обсуждении с бизнесом "если мы из условия выкинем эту штуку маленькую, то можем успеть сделать не за месяц, а за три дня"

40:00 ежедневные бэкапы и мониторинг аптайма, памяти, диска - must have

42:10 levelsio был у Лекса Фридмана, делает всё водиночку

43:20 Начать можно на одной машинке, но при росте системы: load balancer, replication, switch master-slave, распределение данных между базами. CDN, edge, разные алгоритмы кэширования. БД: индексирование, consistent hashing.

45:45 С другой стороны, если вы будете заранее всё оптимизировать, вы не увидите границы системы, когда что-то начинает тормозить и почему. Как с прививками "а зачем это надо?".

47:00 опытные знают, что лучше брать ребят из аутсорс-агенств, много проектов, прошли огонь и воду. Иначе есть риск нанять архитектурного астронавта из мира розовых пони. "О программировании", "Снова о программировании" Джоэл Спольски.

48:25 При принятии решения о шардировании важно понимание различий между Stateless и Stateful.

53:20 Правильный вопрос: "что должно случиться, чтобы я начал терять деньги или перестал их зарабатывать". Как может сломаться сайт? DNS, HTTPS. В датацентре может полететь питание, связь, жёсткий диск. У РокетБанка один экскаватор вырубил оба интернет-кабеля.

57:00 Equit? Ульяновский проект, был популярный аналог Shopify. Датацентр Amazon с проектом смыло! Надо было брать RDS с мультизоной. Disaster Recovery - что будет, если кардинально пойдёт не так. SRE: RTO (допустимое время восстановления, от оборота бизнеса), RPO (допустимый интервал потери данных - 3 минуты, час, день...)

1:01:00 тренировочные ручные и автототесы развёртывания из бэкапа. Бывало, что бэкап делается по отчётам, а на деле - нет.

1:05:00 внутренние угрозы: приходится перед увольнением отнимать доступы автоматически. В базах есть галочки deletion protection. Amazon заставляет писатьт permanently delete вручную при удалении объектов

1:07:00 аналитиков не пускают в основную базу: вешают процессов, занимают память, в результате кэш уезжает. Пускать в репликацию, а лучше в витрину, где данные лежат оптимально, data warehouse.

1:09:20 Учитывать госструктуры (не только в РФ): может начать сбоить DNS, потому что его могут случайно зацепить блокировки.

1:10:30 стейт не надо хранить на сервере, а в Redis'е. Сейчас все фреймворки и облака стараются быть S3-compatible, нет vendor-lock'а на Amazon.

1:15:35 externalize your state. В кубере стейт вообще не нужен: внутри только код, файлы монтируются снаружи.

1:17:00 а как проверять, что пользователь есть? Сам делаешь аутентификацию через базу либо Amazon Cognito, Auth0

1:18:20 современный мир во многом про интеграцию: маркетинг, CRM, аналитика, документооборот. Огромное время интеграциями занимаешься. Но нужно уметь избегать vendor-лока и госблокировок (со Stripe на Cloud Payments). Стали стараться использовать OpenSource-сервисы, которые если что можно развернуть у себя. Аналитика Amplitude урезали бесплатный план, подняли цены. PostHog можно себе поставить (python). Matomo/Piwik (PHP) вместо Google-аналитики. integration platform: Zapier позволяет интегрировать любой сервис с любым. Дорого масштабировать, когда число событий растёт. Альтернатива: N8N (TypeScript).

1:22:00 Создать балансер уже 10 лет как это просто в админпанели облачного хостинга нажать "создать балансер" и указать две тачки, которые под ним сидят. Если балансер узнаёт, что тачка умерла, он сам её убирает (healthcheck, response timeout). Но можно добавить балансировку по CPU и memory consumption, для этого надо Prometheus (Go) метрики куда-то складывать. Autoscaling groups в облаке.

1:25:00 Load balancer позволяет масштабировать достаточно долго, пока не упрёмся в базу. Mongo cluster, MongoDB Atlas, переключение нод. На kubernetes можно построить "живую" систему, которая сама в реально времени масштабируется. Поэтому все говорят "You're not Google -  не надо решать проблемы сильно заранее". Обычно базовых тактик хватает.

1:27:00 CDN Cloudflare стоит копейки, от DDOS защищает, кэширование включает, HTTPS.

1:28:30 После "упирания в базу" индексы, кэширование. Антипаттерн - кэширование подключать везде, борьба со следствием, а не с причиной. Кэш подходит тогда, когда данные редко меняются. К кэшам нужно относиться как к злу, которого желательно избегать.

1:31:15 RDS делает 60% за тебя

1:32:00 микросервисы решают определённую проблему - связь разных технологий (например, с machine learning pipeline). Другая причина - разные команды с разными требованиями и разными релизными циклами. Modular monolith на первые пару лет должно хватить.

1:34:00 микросервис - это внутренняя проблема продукта, это "кишки". Внешний API максимально простой, работа как с одним целым. Time-to-market микросервисов будет больше. Интеграция между сервисами: очереди, контракты. Синхронизация баз данных микросервисов: распределённые транзакции: сквозные транзакции, двухфазные коммиты, трёхфазные коммиты, саги, все со своими проблемами.

1:37:30 проектирование: посчитать затраты на ресурсы, trade-off'ы, ограничения, proof-of-concept, обсуждения. Дизайн-интервью (System Design Interview): на опыте рассказать за 1.5 часа о том, что занимает недели. Проверка зрелости разработчика, seniority. Важно, чтобы уточнял задание и "собирал требования". Выясняется ещё, насколько архитектор может на деньги подставить, чтобы не пытался делать дорогие облачные решения для низкозагруженных проектов.

1:45:00 Durability, retention, availability, single point of failure

48:30 задача программиста - решить бизнес-задачу \[оптимальным\] техническим путём. Не всегда нужно писать код. Иногда нужно взять готовый сервис. Ваша ценность на рынке будет выше, если вы научитесь не сразу делать, а обсуждать, уточнять, что и почему нужно, и предлагать другие решения.

1:51:40 Если человек претендует на лидерскую позицию, он должен представлять, как бизнес зарабатывает. Допустим, человек не любит фреймворки. Это будет выражаться и в том, какие игрушки предпочитает и как в них играет.

1:52:40 Наша природа не в том, чтобы строить сложные системы, когда это необязательно. А в том, чтобы выживать.